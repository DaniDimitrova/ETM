<p id="notice"><%= notice %></p>
<script src="//maps.google.com/maps/api/js?v=3.18&sensor=false&client=&key=&libraries=geometry&language=&hl=&region="></script>
<script src="//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js"></script>
<script src='//google-maps-utility-library-v3.googlecode.com/svn/tags/infobox/1.1.9/src/infobox_packed.js' type='text/javascript'></script>
<!-- only if you need custom infoboxes -->
<script src='//google-maps-utility-library-v3.googlecode.com/svn/trunk/richmarker/src/richmarker-compiled.js' type='text/javascript'></script>
<div id="main-container" class="container">
  <div class="row">
    <h1> Welcome to ETM!</h1>
  </div>
  <div class="row">
    <div>
      <div id="map"></div>
    </div>
  </div>

<table class=table>
  <thead>
    <tr>
      <th colspan="3"></th>
    </tr>
  </thead>

  <tbody>
    <% @museums.each do |museum| %>
    <tr>
      <td><%= museum.name %></td>
      <td><%= link_to 'Show', museum %></td>
      <td><%= link_to 'Edit', edit_museum_path(museum) %></td>
      <td><%= link_to 'Destroy', museum, method: :delete, data: { confirm: 'Are you sure?' } %></td>
    </tr>
    <% end %>
  </tbody>
</table>

<br>

<%= link_to 'New Museum', new_museum_path %>

<script>
  markers = handler.addMarkers(<%=raw @hash.to_json %>);
</script>

<script type="text/javascript" charset="utf-8">
  var CustomMarkerBuilder,
    handler,
    extend = function (child, parent) {
      for (var key in parent) {
        if (hasProp.call(parent, key))
          child[key] = parent[key];
        }
      function ctor() {
        this.constructor = child;
      }
      ctor.prototype = parent.prototype;
      child.prototype = new ctor();
      child.__super__ = parent.prototype;
      return child;
    },
    hasProp = {}.hasOwnProperty;

  CustomMarkerBuilder = (function (superClass) {
    extend(CustomMarkerBuilder, superClass);

    function CustomMarkerBuilder() {
      return CustomMarkerBuilder.__super__.constructor.apply(this, arguments);
    }

    // CustomMarkerBuilder.prototype.create_marker = function () {
    //   var options;
    //   options = _.extend(this.marker_options(), this.rich_marker_options());
    //   return this.serviceObject = new RichMarker(options);
    // };
    //
    // CustomMarkerBuilder.prototype.rich_marker_options = function () {
    //   var marker;
    //   marker = document.createElement("div");
    //   marker.setAttribute('class', 'custom_marker_content');
    //   marker.innerHTML = this.args.custom_marker;
    //   return {content: marker};
    // };

    CustomMarkerBuilder.prototype.create_infowindow = function () {
      var boxText;
      if (!_.isString(this.args.custom_infowindow)) {
        return null;
      }
      boxText = document.createElement("div");
      //boxText.setAttribute("class", 'custom_infowindow_content');
      boxText.style.cssText = "border: 1px solid black; margin-top: 8px; background: white; padding: 5px;max-width: 160px;"
      boxText.innerHTML = this.args.custom_infowindow;
      return this.infowindow = new InfoBox(this.infobox(boxText));
    };

    CustomMarkerBuilder.prototype.infobox = function (boxText) {
      return {
        content: boxText,
        pixelOffset: new google.maps.Size(-140, 0),
      };
    };

    return CustomMarkerBuilder;

  })(Gmaps.Google.Builders.Marker);

  handler = Gmaps.build("Google", {
    builders: {
      Marker: CustomMarkerBuilder
    }
  });

  handler.buildMap({internal: {id: "map"}}, function () {
    markers = handler.addMarkers(<%=raw @hash.to_json %>);
    handler.bounds.extendWith(markers);
    handler.fitMapToBounds();
  });

  // --- generated by coffee-script 1.9.2
</script>
