function SortCoordinates(x1,x2,y1,y2){
  var coords = new Array(4);
  if (x2 > x1){
    coords[0] = x1.toString();
    coords[2] = x2.toString();
  }
  else {
    coords[0] = x2.toString();
    coords[2] = x1.toString();
  }
  if (y2 > y1){
    coords[1] = y1.toString();
    coords[3] = y2.toString();
  }
  else {
    coords[1] = y2.toString();
    coords[3] = y1.toString();
  }
  return coords;
}
function BuildArea(coords){
  return "<area alt='' title='' href= 'http://www.google.com' shape='rect' coords='"+ coords.join() + "' />";
}

// http://www.chestysoft.com/imagefile/javascript/get-coordinates.asp
function FindPosition(oElement)
{
  if(typeof( oElement.offsetParent ) != "undefined")
  {
    for(var posX = 0, posY = 0; oElement; oElement = oElement.offsetParent)
    {
      posX += oElement.offsetLeft;
      posY += oElement.offsetTop;
    }
      return [ posX, posY ];
    }
    else
    {
      return [ oElement.x, oElement.y ];
    }
}

function GetCoordinates(e){
  var PosX = 0;
  var PosY = 0;
  var ImgPos;
  ImgPos = FindPosition(myImg);
  if (!e) var e = window.event;
  if (e.pageX || e.pageY)
  {
    PosX = e.pageX;
    PosY = e.pageY;
  }
  else if (e.clientX || e.clientY)
    {
      PosX = e.clientX + document.body.scrollLeft
        + document.documentElement.scrollLeft;
      PosY = e.clientY + document.body.scrollTop
        + document.documentElement.scrollTop;
    }
  PosX = PosX - ImgPos[0];
  PosY = PosY - ImgPos[1];
  var coordinates = [PosX, PosY];
  console.log(coordinates);
  console.log("drawing: " + drawing);
  logCoordinates(coordinates);
}

function logCoordinates(coordinates){
  if (drawing == 2) {
    coord1 = coordinates;
    drawing = 1;
  }
  else if (drawing == 1) {
    coord2 = coordinates;
    drawing = 0;
    $("#floormap-img").css("cursor", "default");
    showResults(coord1, coord2);
  }
}

function showResults(coord1, coord2){
  var sortedCoords = SortCoordinates(coord1[0], coord2[0], coord1[1], coord2[1]);
  var temp = new TempDiv(sortedCoords);
  temp.draw();
  var gui = new dat.GUI();
  var leftControl = gui.add(temp, 'leftCoordinate');
  leftControl.onChange(function(value){
    temp.leftCoordinate = value;
    temp.draw();
  });
  // leftControl.step(5);
  leftControl.name('Left Coordinate');

  var topControl = gui.add(temp, 'topCoordinate');
  topControl.onChange(function(value){
    temp.topCoordinate = value;
    temp.draw();
  });
  // topControl.step(5);
  topControl.name('Top Coordinate');

  var widthControl = gui.add(temp, 'width');
  widthControl.onChange(function(value){
    temp.width = value;
    temp.draw();
  });
  widthControl.name('Width');

  var heightControl = gui.add(temp, 'height');
  heightControl.onChange(function(value){
    temp.height = value;
    temp.draw();
  });
  heightControl.name('Height');
  var saveControl = gui.add(temp, "save");
  saveControl.name('SAVE');

}
var TempDiv = function(coords){
  this.leftCoordinate = coords[0];
  this.rightCoordinate = coords[2];
  this.topCoordinate = coords[1];
  this.bottomCoordinate = coords[3];
  this.width = this.rightCoordinate - this.leftCoordinate;
  this.height = this.bottomCoordinate - this.topCoordinate;
  // $('#floor').prepend("<div style='width: 200px; height: 100px; border-style: dotted; border-width: medium;'> </div>");

  this.draw = function(){
    if ($('#scaffold').length){
      $('#scaffold').replaceWith("<div id='scaffold' style='position: absolute; left: " + this.leftCoordinate.toString() + "; top: " + this.topCoordinate.toString() + "; width: " + this.width.toString() + "; height: " + this.height.toString() + "; border-style: dotted; border-width: medium;' </div>");
    }
    else {
      $('#mapster_wrap_0').append("<div id='scaffold' style='position: absolute; left: " + this.leftCoordinate.toString() + "; top: " + this.topCoordinate.toString() + "; width: " + this.width.toString() + "; height: " + this.height.toString() + "; border-style: dotted; border-width: medium;' </div>");
    }
  }

  this.save = function(){
    var newArea = BuildArea([this.leftCoordinate,this.topCoordinate,this.rightCoordinate,this.bottomCoordinate]);
    $('img').mapster('unbind');
    $('#floor').html(originalContent);
    $('#floor-map').append(newArea);
    console.log(newArea);
    originalContent = $('#floor').clone().html();
    $('img').mapster({
      singleSelect : true,
      clickNavigate : true
    });
    // $(document).ready(onWindowResize);
  }
}
