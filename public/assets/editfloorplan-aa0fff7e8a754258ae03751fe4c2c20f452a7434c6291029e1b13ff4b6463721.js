function initializeEditMapster(){$("img").mapster({singleSelect:!0,clickNavigate:!1,onClick:function(){position=$(this).attr("coords").split(",");var t=new TempDiv(position);oldLink=$(this).attr("href"),oldLink=oldLink.substring(oldLink.lastIndexOf("/")+1),console.log(oldLink),t.artwork=oldLink,t.draw(),drawGui(t)}}),$("#mapster_wrap_0").append("<div id='scaffold' style='display: none;'</div>")}function storeCoordinates(){mouse.startX=mouse.x,mouse.startY=mouse.y}function SortCoordinates(t,o,e,i){var n=new Array(4);return n[0]=Math.min(t,o),n[2]=Math.max(t,o),n[1]=Math.min(e,i),n[3]=Math.max(e,i),n}function BuildArea(t,o){return"<area alt='' title='' href= '"+o+"' shape='rect' coords='"+t.join()+"' />"}function FindPosition(t){if("undefined"!=typeof t.offsetParent){for(var o=0,e=0;t;t=t.offsetParent)o+=t.offsetLeft,e+=t.offsetTop;return[o,e]}return[t.x,t.y]}function setMousePosition(t){var o,e=0,i=0;if(o=FindPosition(myImg),!t)var t=window.event;t.pageX||t.pageY?(e=t.pageX,i=t.pageY):(t.clientX||t.clientY)&&(e=t.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,i=t.clientY+document.body.scrollTop+document.documentElement.scrollTop),e-=o[0],i-=o[1],mouse.x=e,mouse.y=i}function drawTemp(){var t=SortCoordinates(mouse.x,mouse.startX,mouse.y,mouse.startY),o=new TempDiv(t);return o.draw(),o}function drawGui(t){var o=new dat.GUI({autoPlace:!1});document.getElementById("gui-container").appendChild(o.domElement);var e=o.add(t,"leftCoordinate",0,myImg.offsetWidth);e.onChange(function(o){t.leftCoordinate=o,t.rightCoordinate=o+t.width,t.draw()}),e.name("Left Coordinate");var i=o.add(t,"topCoordinate",0,myImg.offsetHeight);i.onChange(function(o){t.topCoordinate=o,t.bottomCoordinate=o+t.height,t.draw()}),i.name("Top Coordinate");var n=o.add(t,"width",0,300);n.onChange(function(o){t.width=o,t.rightCoordinate=t.leftCoordinate+t.width,t.draw()}),n.name("Width"),n.listen();var a=o.add(t,"height",0,300);a.onChange(function(o){t.height=o,t.bottomCoordinate=t.topCoordinate+t.height,t.draw()}),a.name("Height"),a.listen();var r=o.add(t,"artwork",buildArtworkList());r.name("Artwork");var d=o.add(t,"save");d.name("SAVE");var s=o.add(t,"cancel");s.name("Cancel"),$("select").addClass("dat-ui-selection")}function buildArtworkList(){return none={NONE:-1},artworks=JSON.parse(gon.artworks),$.extend({},none,artworks)}var mouse={x:0,y:0,startX:0,startY:0,drawing:0},saveURL="/artworks/",originalContent=$("#floor").clone().html(),TempDiv=function(t){this.leftCoordinate=t[0],this.rightCoordinate=t[2],this.topCoordinate=t[1],this.bottomCoordinate=t[3],this.width=this.rightCoordinate-this.leftCoordinate,this.height=this.bottomCoordinate-this.topCoordinate,this.artwork=-1,this.draw=function(){this.checkForBounds(),$("#scaffold").replaceWith("<div id='scaffold' style='position: absolute; left: "+this.leftCoordinate.toString()+"; top: "+this.topCoordinate.toString()+"; width: "+this.width.toString()+"; height: "+this.height.toString()+"; border-style: dotted; border-width: medium;' </div>")},this.save=function(){if(-1!=this.artwork){saveTo=saveURL+this.artwork;var t=BuildArea([this.leftCoordinate,this.topCoordinate,this.rightCoordinate,this.bottomCoordinate],saveTo);$("img").mapster("unbind"),$("#floor").html(originalContent),$("[href$='"+saveTo+"']").remove(),$("#floor-map").append(t),originalContent=$("#floor").clone().html(),console.log(originalContent),initializeEditMapster(),$("#mapster_wrap_0").append("<div id='scaffold' style='display: none;'</div>"),$(".dg.main.a").remove(),dataToSend=JSON.stringify({left:this.leftCoordinate,right:this.rightCoordinate,top:this.topCoordinate,bottom:this.bottomCoordinate}),console.log(dataToSend),console.log(saveURL+this.artwork),$.ajax({data:dataToSend,type:"PUT",url:saveURL+this.artwork,dataType:"json",contentType:"application/json",success:function(){console.log("SHOULD BE SAVED!!!")},error:function(t,o,e){console.log("ERROR WITH AJAX:"+t+o+e)}})}console.log("NOTcanceling"),$("#scaffold").replaceWith("<div id='scaffold' style='display: none;'</div>"),$(".dg.main").remove(),$("area").mapster("deselect")},this.cancel=function(){console.log("canceling"),$("#scaffold").replaceWith("<div id='scaffold' style='display: none;'</div>"),$(".dg.main").remove(),$("area").mapster("deselect")},this.checkForBounds=function(){maxX=myImg.offsetWidth,maxY=myImg.offsetHeight,this.leftCoordinate=Math.max(this.leftCoordinate,0),this.rightCoordinate=Math.min(this.rightCoordinate,maxX),this.topCoordinate=Math.max(this.topCoordinate,0),this.bottomCoordinate=Math.min(this.bottomCoordinate,maxY),this.width=this.rightCoordinate-this.leftCoordinate,this.height=this.bottomCoordinate-this.topCoordinate}};